// KIRO-AI: Dashboard moderne avec design system et micro-interactions
import Card from './ui/Card.jsx';
import Badge from './ui/Badge.jsx';

function ModernDashboard({ issues, report }) {
  // KIRO-AI: Calculer les statistiques par s√©v√©rit√©
  const stats = {
    high: issues.filter(i => i.severity === 'high').length,
    medium: issues.filter(i => i.severity === 'medium').length,
    low: issues.filter(i => i.severity === 'low').length,
  };

  // KIRO-AI: Calculer les statistiques par type
  const byType = {};
  issues.forEach(issue => {
    byType[issue.type] = (byType[issue.type] || 0) + 1;
  });

  const types = Object.entries(byType);
  const total = issues.length;

  // KIRO-AI: Score UX global bas√© sur la s√©v√©rit√©
  const calculateUXScore = () => {
    if (total === 0) return 100;
    const weightedScore = (stats.high * 3 + stats.medium * 2 + stats.low * 1);
    const maxPossibleScore = total * 3;
    return Math.max(0, Math.round(100 - (weightedScore / maxPossibleScore) * 100));
  };

  const uxScore = calculateUXScore();

  // KIRO-AI: Couleurs pour le graphique donut
  const colors = ['var(--color-primary)', 'var(--color-secondary)', 'var(--color-warning)', 'var(--color-error)', 'var(--color-success)'];

  // KIRO-AI: Calculer les segments pour le donut
  let currentAngle = 0;
  const segments = types.map(([type, count], index) => {
    const percentage = count / total;
    const angle = percentage * 360;
    const startAngle = currentAngle;
    currentAngle += angle;

    return {
      type,
      count,
      percentage,
      startAngle,
      angle,
      color: colors[index % colors.length],
    };
  });

  // KIRO-AI: Fonction pour cr√©er les arcs SVG
  const polarToCartesian = (centerX, centerY, radius, angleInDegrees) => {\n    const angleInRadians = ((angleInDegrees - 90) * Math.PI) / 180.0;\n    return {\n      x: centerX + radius * Math.cos(angleInRadians),\n      y: centerY + radius * Math.sin(angleInRadians),\n    };\n  };\n\n  const describeArc = (x, y, radius, startAngle, endAngle) => {\n    const start = polarToCartesian(x, y, radius, endAngle);\n    const end = polarToCartesian(x, y, radius, startAngle);\n    const largeArcFlag = endAngle - startAngle <= 180 ? '0' : '1';\n    return [\n      'M', start.x, start.y,\n      'A', radius, radius, 0, largeArcFlag, 0, end.x, end.y,\n    ].join(' ');\n  };

  return (\n    <div className=\"modern-dashboard\" style={{ marginBottom: 'var(--space-8)' }}>\n      {/* KIRO-AI: Badge de source d'analyse avec animation */}\n      {report && (\n        <div className=\"fade-in\" style={{ marginBottom: 'var(--space-6)' }}>\n          <Badge \n            variant={report.source === 'kat-coder-pro:free' ? 'secondary' : 'warning'}\n            size=\"lg\"\n            icon={report.source === 'kat-coder-pro:free' ? 'üß†' : '‚öôÔ∏è'}\n            pulse={report.source === 'kat-coder-pro:free'}\n          >\n            {report.source === 'kat-coder-pro:free' \n              ? 'Analyzed by KAT-Coder-Pro (OpenRouter)'\n              : 'Local heuristic analysis'\n            }\n          </Badge>\n        </div>\n      )}\n\n      {/* KIRO-AI: Grille de m√©triques principales */}\n      <div className=\"grid-auto-fit\" style={{ marginBottom: 'var(--space-8)' }}>\n        {/* KIRO-AI: Score UX global */}\n        <Card variant=\"primary\" size=\"lg\" hover className=\"scale-in\">\n          <div style={{ textAlign: 'center' }}>\n            <div style={{ \n              fontSize: 'var(--font-size-sm)', \n              opacity: 0.9, \n              marginBottom: 'var(--space-2)',\n              fontWeight: 'var(--font-weight-medium)'\n            }}>\n              UX Score\n            </div>\n            <div style={{ \n              fontSize: 'var(--font-size-4xl)', \n              fontWeight: 'var(--font-weight-bold)', \n              marginBottom: 'var(--space-4)',\n              background: 'linear-gradient(45deg, rgba(255,255,255,0.9), rgba(255,255,255,0.7))',\n              WebkitBackgroundClip: 'text',\n              WebkitTextFillColor: 'transparent',\n              backgroundClip: 'text'\n            }}>\n              {uxScore}%\n            </div>\n            <div style={{ \n              display: 'flex', \n              justifyContent: 'center', \n              gap: 'var(--space-4)',\n              fontSize: 'var(--font-size-sm)',\n              opacity: 0.9\n            }}>\n              <span>üî¥ {stats.high}</span>\n              <span>üü° {stats.medium}</span>\n              <span>üü¢ {stats.low}</span>\n            </div>\n          </div>\n        </Card>\n\n        {/* KIRO-AI: Total des probl√®mes */}\n        <Card variant=\"elevated\" size=\"lg\" hover className=\"slide-in\">\n          <div>\n            <div style={{ \n              fontSize: 'var(--font-size-sm)', \n              color: 'var(--color-gray-600)', \n              marginBottom: 'var(--space-2)',\n              fontWeight: 'var(--font-weight-medium)'\n            }}>\n              Total Issues\n            </div>\n            <div style={{ \n              fontSize: 'var(--font-size-3xl)', \n              fontWeight: 'var(--font-weight-bold)', \n              color: 'var(--color-gray-900)',\n              marginBottom: 'var(--space-4)'\n            }}>\n              {total}\n            </div>\n            <div style={{ \n              display: 'flex', \n              gap: 'var(--space-4)', \n              flexWrap: 'wrap'\n            }}>\n              <Badge variant=\"high\" icon=\"üî¥\">\n                Critical {stats.high}\n              </Badge>\n              <Badge variant=\"medium\" icon=\"üü°\">\n                Medium {stats.medium}\n              </Badge>\n              <Badge variant=\"low\" icon=\"üü¢\">\n                Minor {stats.low}\n              </Badge>\n            </div>\n          </div>\n        </Card>\n\n        {/* KIRO-AI: R√©partition par type avec graphique moderne */}\n        <Card variant=\"elevated\" size=\"lg\" hover className=\"fade-in\" style={{ gridColumn: 'span 2' }}>\n          <div style={{ \n            fontSize: 'var(--font-size-sm)', \n            color: 'var(--color-gray-600)', \n            marginBottom: 'var(--space-4)',\n            fontWeight: 'var(--font-weight-medium)'\n          }}>\n            Distribution by Category\n          </div>\n          \n          {total > 0 ? (\n            <div style={{ \n              display: 'grid', \n              gridTemplateColumns: 'auto 1fr', \n              gap: 'var(--space-8)',\n              alignItems: 'center'\n            }}>\n              {/* KIRO-AI: Graphique donut moderne */}\n              <div style={{ position: 'relative' }}>\n                <svg width=\"140\" height=\"140\" viewBox=\"0 0 140 140\">\n                  {/* Cercle de fond */}\n                  <circle \n                    cx=\"70\" \n                    cy=\"70\" \n                    r=\"55\" \n                    fill=\"none\" \n                    stroke=\"var(--color-gray-200)\" \n                    strokeWidth=\"20\"\n                  />\n                  \n                  {/* Segments color√©s */}\n                  {segments.map((segment, index) => (\n                    <path\n                      key={index}\n                      d={describeArc(70, 70, 55, segment.startAngle, segment.startAngle + segment.angle)}\n                      fill=\"none\"\n                      stroke={segment.color}\n                      strokeWidth=\"20\"\n                      strokeLinecap=\"round\"\n                      style={{\n                        filter: 'drop-shadow(0 2px 4px rgba(0,0,0,0.1))',\n                        transition: 'all var(--transition-fast)'\n                      }}\n                    />\n                  ))}\n                  \n                  {/* Centre avec total */}\n                  <circle cx=\"70\" cy=\"70\" r=\"35\" fill=\"var(--color-surface-elevated)\" />\n                  <text\n                    x=\"70\"\n                    y=\"70\"\n                    textAnchor=\"middle\"\n                    dominantBaseline=\"middle\"\n                    style={{ \n                      fontSize: '24px', \n                      fontWeight: 'var(--font-weight-bold)', \n                      fill: 'var(--color-gray-900)'\n                    }}\n                  >\n                    {total}\n                  </text>\n                </svg>\n              </div>\n\n              {/* KIRO-AI: L√©gende moderne */}\n              <div style={{ \n                display: 'grid', \n                gridTemplateColumns: 'repeat(auto-fit, minmax(120px, 1fr))',\n                gap: 'var(--space-3)'\n              }}>\n                {segments.map((segment, index) => {\n                  const typeIcons = {\n                    latency: '‚è±Ô∏è',\n                    accessibility: '‚ôø',\n                    contrast: 'üé®',\n                    'JS error': 'üö®'\n                  };\n                  \n                  return (\n                    <div\n                      key={index}\n                      className=\"hover-lift\"\n                      style={{\n                        display: 'flex',\n                        alignItems: 'center',\n                        gap: 'var(--space-2)',\n                        padding: 'var(--space-2)',\n                        borderRadius: 'var(--border-radius-md)',\n                        cursor: 'pointer',\n                        transition: 'all var(--transition-fast)'\n                      }}\n                      onMouseEnter={(e) => {\n                        e.currentTarget.style.backgroundColor = 'var(--color-gray-50)';\n                      }}\n                      onMouseLeave={(e) => {\n                        e.currentTarget.style.backgroundColor = 'transparent';\n                      }}\n                    >\n                      <div\n                        style={{\n                          width: '12px',\n                          height: '12px',\n                          borderRadius: 'var(--border-radius-sm)',\n                          backgroundColor: segment.color,\n                          boxShadow: 'var(--shadow-sm)'\n                        }}\n                      />\n                      <span style={{ fontSize: '1.2em' }}>\n                        {typeIcons[segment.type] || 'üìã'}\n                      </span>\n                      <div>\n                        <div style={{ \n                          fontSize: 'var(--font-size-sm)', \n                          fontWeight: 'var(--font-weight-medium)',\n                          color: 'var(--color-gray-900)'\n                        }}>\n                          {segment.type}\n                        </div>\n                        <div style={{ \n                          fontSize: 'var(--font-size-xs)', \n                          color: 'var(--color-gray-600)'\n                        }}>\n                          {segment.count} issues\n                        </div>\n                      </div>\n                    </div>\n                  );\n                })}\n              </div>\n            </div>\n          ) : (\n            <div style={{ \n              textAlign: 'center', \n              color: 'var(--color-gray-500)', \n              padding: 'var(--space-8)',\n              fontSize: 'var(--font-size-lg)'\n            }}>\n              No data available\n            </div>\n          )}\n        </Card>\n      </div>\n\n      {/* KIRO-AI: R√©sum√© du rapport LLM */}\n      {report?.summary && (\n        <Card variant=\"glass\" size=\"lg\" className=\"fade-in\">\n          <div style={{ \n            display: 'flex',\n            alignItems: 'flex-start',\n            gap: 'var(--space-4)'\n          }}>\n            <div style={{ \n              fontSize: '2em',\n              filter: 'drop-shadow(0 2px 4px rgba(0,0,0,0.1))'\n            }}>\n              üìä\n            </div>\n            <div>\n              <div style={{ \n                fontSize: 'var(--font-size-lg)', \n                fontWeight: 'var(--font-weight-semibold)',\n                color: 'var(--color-gray-900)',\n                marginBottom: 'var(--space-2)'\n              }}>\n                Analysis Summary\n              </div>\n              <p style={{ \n                margin: 0, \n                color: 'var(--color-gray-700)', \n                lineHeight: 'var(--line-height-relaxed)',\n                fontSize: 'var(--font-size-base)'\n              }}>\n                {report.summary}\n              </p>\n            </div>\n          </div>\n        </Card>\n      )}\n\n      {/* KIRO-AI: Indicateur de cat√©gories analys√©es */}\n      <div style={{ \n        display: 'flex',\n        justifyContent: 'center',\n        marginTop: 'var(--space-6)'\n      }}>\n        <Badge \n          variant=\"info\" \n          size=\"lg\"\n          icon=\"üß†\"\n        >\n          {types.length} categor{types.length > 1 ? 'ies' : 'y'} analyzed\n        </Badge>\n      </div>\n    </div>\n  );\n}\n\nexport default ModernDashboard;